<mxfile host="app.diagrams.net" modified="2025-12-02T16:30:00.000Z" agent="Mozilla/5.0" version="22.1.0" type="device">
  <diagram name="System Architecture" id="architecture-diagram">
    <mxGraphModel dx="1434" dy="780" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Adaptive Bandwidth Controller Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="400" height="30" as="geometry" />
        </mxCell>
        
        <!-- Kubernetes Cluster Box -->
        <mxCell id="k8s-cluster" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="1320" height="780" as="geometry" />
        </mxCell>
        <mxCell id="k8s-label" value="Kubernetes Cluster (kubeadm v1.30.14)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="75" width="300" height="20" as="geometry" />
        </mxCell>
        
        <!-- Control Plane (kube-system namespace) -->
        <mxCell id="control-plane" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="60" y="110" width="500" height="320" as="geometry" />
        </mxCell>
        <mxCell id="control-label" value="kube-system namespace" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="70" y="115" width="180" height="20" as="geometry" />
        </mxCell>
        
        <!-- Kubernetes API Server -->
        <mxCell id="api-server" value="&lt;b&gt;Kubernetes API Server&lt;/b&gt;&lt;br&gt;kube-apiserver&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;Deployment CRUD&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="150" width="180" height="70" as="geometry" />
        </mxCell>
        
        <!-- Flow Manager -->
        <mxCell id="flow-manager" value="&lt;b&gt;Flow Manager Controller&lt;/b&gt;&lt;br&gt;Python + prometheus_client&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;Port 8001 (metrics)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="250" width="180" height="70" as="geometry" />
        </mxCell>
        
        <!-- Flow Manager Internal Components -->
        <mxCell id="fm-internal" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ffe6;strokeColor=#82b366;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="145" width="260" height="270" as="geometry" />
        </mxCell>
        <mxCell id="fm-internal-label" value="Flow Manager Internals" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="290" y="150" width="140" height="15" as="geometry" />
        </mxCell>
        
        <mxCell id="config-loader" value="&lt;b&gt;Config Loader&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;critical-apps-config&lt;br&gt;ConfigMap (YAML)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="295" y="170" width="110" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="rolling-window" value="&lt;b&gt;Rolling Window&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;20 samples/app&lt;br&gt;IQR jitter calc&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="415" y="170" width="110" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="aimd-controller" value="&lt;b&gt;AIMD Controller&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Throttle: -50 Mbps&lt;br&gt;Release: +20 Mbps&lt;br&gt;Threshold: 0.3ms&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="295" y="235" width="110" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="prom-exporter" value="&lt;b&gt;Prometheus Exporter&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;flowmanager_udp_jitter_ms&lt;br&gt;flowmanager_tcp_jitter_ms&lt;br&gt;flowmanager_bandwidth_limit_mbps&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="415" y="235" width="115" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="k8s-client" value="&lt;b&gt;K8s Python Client&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;AppsV1Api&lt;br&gt;patch_namespaced_deployment&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="295" y="310" width="110" height="55" as="geometry" />
        </mxCell>
        
        <mxCell id="protocol-filter" value="&lt;b&gt;Protocol Filter&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;UDP → control&lt;br&gt;TCP → monitor only&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="415" y="320" width="115" height="50" as="geometry" />
        </mxCell>
        
        <!-- Default Namespace -->
        <mxCell id="default-ns" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="580" y="110" width="380" height="320" as="geometry" />
        </mxCell>
        <mxCell id="default-label" value="default namespace" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="590" y="115" width="140" height="20" as="geometry" />
        </mxCell>
        
        <!-- Network Probe -->
        <mxCell id="network-probe" value="&lt;b&gt;Network Probe&lt;/b&gt;&lt;br&gt;Python + socket&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;Port 9090 (metrics)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="600" y="150" width="150" height="60" as="geometry" />
        </mxCell>
        
        <!-- Critical Apps -->
        <mxCell id="critical-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#28a745;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="230" width="150" height="120" as="geometry" />
        </mxCell>
        <mxCell id="critical-label" value="Critical (priority: high)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;fontColor=#28a745;" vertex="1" parent="1">
          <mxGeometry x="605" y="235" width="140" height="15" as="geometry" />
        </mxCell>
        
        <mxCell id="robot-control" value="&lt;b&gt;robot-control&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;UDP:5201&lt;br&gt;SLA: jitter &lt; 0.3ms&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#28a745;" vertex="1" parent="1">
          <mxGeometry x="610" y="255" width="130" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="safety-scanner" value="&lt;b&gt;safety-scanner&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;TCP:5202&lt;br&gt;SLA: throughput &gt; 50Mbps&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#28a745;" vertex="1" parent="1">
          <mxGeometry x="610" y="300" width="130" height="40" as="geometry" />
        </mxCell>
        
        <!-- Best Effort Apps -->
        <mxCell id="besteffort-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8d7da;strokeColor=#dc3545;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="770" y="150" width="170" height="200" as="geometry" />
        </mxCell>
        <mxCell id="besteffort-label" value="Best-Effort (throttleable)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=1;fontColor=#dc3545;" vertex="1" parent="1">
          <mxGeometry x="780" y="155" width="150" height="15" as="geometry" />
        </mxCell>
        
        <mxCell id="telemetry" value="&lt;b&gt;telemetry-upload&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;kubernetes.io/egress-bandwidth&lt;br&gt;Range: 10M - 80M&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8d7da;strokeColor=#dc3545;" vertex="1" parent="1">
          <mxGeometry x="780" y="180" width="150" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="erp" value="&lt;b&gt;erp-dashboard&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;kubernetes.io/egress-bandwidth&lt;br&gt;Range: 10M - 80M&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8d7da;strokeColor=#dc3545;" vertex="1" parent="1">
          <mxGeometry x="780" y="240" width="150" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="annotation-box" value="&lt;font size=&quot;1&quot;&gt;&lt;b&gt;Annotation Patching&lt;/b&gt;&lt;br&gt;spec.template.metadata.annotations&lt;br&gt;triggers pod rolling update&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff3cd;strokeColor=#856404;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="780" y="300" width="150" height="40" as="geometry" />
        </mxCell>
        
        <!-- Monitoring Namespace -->
        <mxCell id="monitoring-ns" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#004085;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="980" y="110" width="360" height="320" as="geometry" />
        </mxCell>
        <mxCell id="monitoring-label" value="monitoring namespace" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="990" y="115" width="150" height="20" as="geometry" />
        </mxCell>
        
        <!-- Prometheus -->
        <mxCell id="prometheus" value="&lt;b&gt;Prometheus&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;Scrapes every 15s&lt;br&gt;Port 9090&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f3ff;strokeColor=#004085;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1000" y="150" width="150" height="60" as="geometry" />
        </mxCell>
        
        <!-- Grafana -->
        <mxCell id="grafana" value="&lt;b&gt;Grafana&lt;/b&gt;&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;Dashboard visualization&lt;br&gt;Port 3000&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f3ff;strokeColor=#004085;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1170" y="150" width="150" height="60" as="geometry" />
        </mxCell>
        
        <!-- Grafana Dashboard Details -->
        <mxCell id="grafana-panels" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#004085;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1000" y="230" width="320" height="120" as="geometry" />
        </mxCell>
        <mxCell id="panel-label" value="Dashboard Panels (job=&quot;flow-manager&quot;)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="1010" y="235" width="200" height="15" as="geometry" />
        </mxCell>
        
        <mxCell id="panel1" value="UDP Jitter&lt;br&gt;&lt;font size=&quot;1&quot;&gt;flowmanager_udp_jitter_ms&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d4edda;strokeColor=#28a745;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1010" y="255" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="panel2" value="TCP Throughput&lt;br&gt;&lt;font size=&quot;1&quot;&gt;flowmanager_tcp_jitter_ms&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#cce5ff;strokeColor=#004085;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1165" y="255" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="panel3" value="Bandwidth Limit&lt;br&gt;&lt;font size=&quot;1&quot;&gt;flowmanager_bandwidth_limit_mbps&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff3cd;strokeColor=#856404;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1010" y="300" width="145" height="35" as="geometry" />
        </mxCell>
        
        <mxCell id="panel4" value="Current BW&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Stat panel&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8d7da;strokeColor=#dc3545;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1165" y="300" width="145" height="35" as="geometry" />
        </mxCell>
        
        <!-- Worker Node with Cilium -->
        <mxCell id="worker-node" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0f0;strokeColor=#333;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="60" y="460" width="600" height="370" as="geometry" />
        </mxCell>
        <mxCell id="worker-label" value="Worker Node (kube-worker-1 / kube-worker-2)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="70" y="465" width="300" height="20" as="geometry" />
        </mxCell>
        
        <!-- Linux Kernel -->
        <mxCell id="kernel" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6e6;strokeColor=#cc0000;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="640" width="560" height="170" as="geometry" />
        </mxCell>
        <mxCell id="kernel-label" value="Linux Kernel (6.8.0-86-generic)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=1;fontColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="90" y="645" width="220" height="15" as="geometry" />
        </mxCell>
        
        <!-- eBPF Subsystem -->
        <mxCell id="ebpf-subsystem" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff0f0;strokeColor=#cc0000;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="665" width="520" height="130" as="geometry" />
        </mxCell>
        <mxCell id="ebpf-label" value="eBPF Subsystem" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2;fontColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="110" y="670" width="100" height="15" as="geometry" />
        </mxCell>
        
        <!-- TC Egress Hook -->
        <mxCell id="tc-hook" value="&lt;b&gt;TC Egress Hook&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Traffic Control hook point&lt;br&gt;Intercepts outgoing packets&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="120" y="690" width="130" height="50" as="geometry" />
        </mxCell>
        
        <!-- eBPF Rate Limiter Program -->
        <mxCell id="ebpf-program" value="&lt;b&gt;eBPF Rate Limiter&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Token bucket algorithm&lt;br&gt;EDT scheduling model&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="270" y="690" width="130" height="50" as="geometry" />
        </mxCell>
        
        <!-- eBPF Maps -->
        <mxCell id="ebpf-maps" value="&lt;b&gt;eBPF Maps&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;bandwidth_limits&lt;br&gt;per-pod rate config&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="420" y="690" width="130" height="50" as="geometry" />
        </mxCell>
        
        <!-- veth pairs -->
        <mxCell id="veth" value="&lt;b&gt;veth Pairs&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Pod network interfaces&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="120" y="750" width="130" height="40" as="geometry" />
        </mxCell>
        
        <!-- Physical NIC -->
        <mxCell id="nic" value="&lt;b&gt;Physical NIC (eth0)&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Virtio network device&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="420" y="750" width="130" height="40" as="geometry" />
        </mxCell>
        
        <!-- Cilium Agent -->
        <mxCell id="cilium-agent" value="&lt;b&gt;Cilium Agent&lt;/b&gt;&lt;br&gt;DaemonSet (v1.18.3)&lt;br&gt;&lt;font color=&quot;#666666&quot;&gt;kubeProxyReplacement=true&lt;br&gt;bandwidthManager.enabled=true&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ccff;strokeColor=#9933ff;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="500" width="200" height="80" as="geometry" />
        </mxCell>
        
        <!-- Cilium CNI -->
        <mxCell id="cilium-cni" value="&lt;b&gt;Cilium CNI Plugin&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Container Network Interface&lt;br&gt;Native routing mode&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ccff;strokeColor=#9933ff;" vertex="1" parent="1">
          <mxGeometry x="300" y="500" width="150" height="55" as="geometry" />
        </mxCell>
        
        <!-- Cilium Bandwidth Manager -->
        <mxCell id="cilium-bwm" value="&lt;b&gt;Bandwidth Manager&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Reads annotation:&lt;br&gt;kubernetes.io/egress-bandwidth&lt;br&gt;Configures eBPF maps&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ccff;strokeColor=#9933ff;" vertex="1" parent="1">
          <mxGeometry x="300" y="565" width="150" height="60" as="geometry" />
        </mxCell>
        
        <!-- containerd -->
        <mxCell id="containerd" value="&lt;b&gt;containerd&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;v1.7.28&lt;br&gt;Container runtime&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d9d9d9;strokeColor=#666;" vertex="1" parent="1">
          <mxGeometry x="470" y="500" width="110" height="55" as="geometry" />
        </mxCell>
        
        <!-- kubelet -->
        <mxCell id="kubelet" value="&lt;b&gt;kubelet&lt;/b&gt;&lt;br&gt;&lt;font size=&quot;1&quot;&gt;Node agent&lt;br&gt;Pod lifecycle&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d9d9d9;strokeColor=#666;" vertex="1" parent="1">
          <mxGeometry x="470" y="565" width="110" height="55" as="geometry" />
        </mxCell>
        
        <!-- Data Flow Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#333;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="460" width="300" height="160" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Data Flow Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="710" y="465" width="120" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="legend1" value="" style="endArrow=classic;html=1;strokeColor=#28a745;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="720" y="500" as="sourcePoint" />
            <mxPoint x="780" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend1-text" value="Active probing (UDP/TCP)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="790" y="490" width="150" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="legend2" value="" style="endArrow=classic;html=1;strokeColor=#004085;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="720" y="530" as="sourcePoint" />
            <mxPoint x="780" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend2-text" value="Prometheus scraping" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="790" y="520" width="150" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="legend3" value="" style="endArrow=classic;html=1;strokeColor=#d6b656;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="720" y="560" as="sourcePoint" />
            <mxPoint x="780" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend3-text" value="K8s API (annotation patch)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="790" y="550" width="150" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="legend4" value="" style="endArrow=classic;html=1;strokeColor=#9933ff;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="720" y="590" as="sourcePoint" />
            <mxPoint x="780" y="590" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend4-text" value="eBPF map updates" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="790" y="580" width="150" height="20" as="geometry" />
        </mxCell>
        
        <!-- Control Loop Summary -->
        <mxCell id="loop-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#333;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="640" width="620" height="190" as="geometry" />
        </mxCell>
        <mxCell id="loop-title" value="Control Loop (every 2 seconds)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="710" y="645" width="200" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="step1" value="1. Probe" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="720" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="step2" value="2. Calculate&lt;br&gt;IQR Jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="820" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="step3" value="3. AIMD&lt;br&gt;Decision" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="920" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="step4" value="4. Patch&lt;br&gt;Annotation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="1020" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="step5" value="5. Cilium&lt;br&gt;Detects" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6ccff;strokeColor=#9933ff;" vertex="1" parent="1">
          <mxGeometry x="1120" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="step6" value="6. eBPF&lt;br&gt;Enforces" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#cc0000;" vertex="1" parent="1">
          <mxGeometry x="1220" y="680" width="80" height="40" as="geometry" />
        </mxCell>
        
        <!-- Step arrows -->
        <mxCell id="s1-s2" value="" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="800" y="700" as="sourcePoint" />
            <mxPoint x="820" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s2-s3" value="" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="900" y="700" as="sourcePoint" />
            <mxPoint x="920" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s3-s4" value="" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1000" y="700" as="sourcePoint" />
            <mxPoint x="1020" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s4-s5" value="" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1100" y="700" as="sourcePoint" />
            <mxPoint x="1120" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="s5-s6" value="" style="endArrow=classic;html=1;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1200" y="700" as="sourcePoint" />
            <mxPoint x="1220" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Decision outcomes -->
        <mxCell id="decisions" value="&lt;b&gt;AIMD Decisions:&lt;/b&gt;&lt;br&gt;• THROTTLE: UDP jitter &gt; 0.3ms → BW -= 50 Mbps&lt;br&gt;• RELEASE: UDP jitter &lt; 0.15ms → BW += 20 Mbps&lt;br&gt;• MAINTAIN: 0.15ms &lt; jitter &lt; 0.3ms → no change" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="720" y="740" width="280" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="timing" value="&lt;b&gt;Timing:&lt;/b&gt;&lt;br&gt;• Probe interval: 0.5s&lt;br&gt;• Control interval: 2.0s&lt;br&gt;• Rolling window: 20 samples&lt;br&gt;• Total reaction: &lt; 2s" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="1020" y="740" width="150" height="80" as="geometry" />
        </mxCell>
        
        <!-- Major Data Flow Arrows -->
        <!-- Network Probe to Critical Apps -->
        <mxCell id="probe-to-apps" value="" style="endArrow=classic;html=1;strokeColor=#28a745;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="network-probe" target="critical-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="probe-label" value="UDP/TCP probes&lt;br&gt;every 0.5s" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8" vertex="1" connectable="0" parent="probe-to-apps">
          <mxGeometry x="0.2" relative="1" as="geometry">
            <mxPoint x="40" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Flow Manager fetches from Network Probe -->
        <mxCell id="fm-fetch-probe" value="" style="endArrow=classic;html=1;strokeColor=#28a745;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;dashed=1;" edge="1" parent="1" source="flow-manager" target="network-probe">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fetch-label" value="HTTP GET&lt;br&gt;/metrics" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8" vertex="1" connectable="0" parent="fm-fetch-probe">
          <mxGeometry x="-0.2" relative="1" as="geometry">
            <mxPoint y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- Flow Manager to API Server -->
        <mxCell id="fm-to-api" value="" style="endArrow=classic;html=1;strokeColor=#d6b656;strokeWidth=2;exitX=0.5;exitY=0;entryX=0.5;entryY=1;" edge="1" parent="1" source="flow-manager" target="api-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="api-label" value="PATCH deploy" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8" vertex="1" connectable="0" parent="fm-to-api">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- API Server to Best Effort Apps -->
        <mxCell id="api-to-be" value="" style="endArrow=classic;html=1;strokeColor=#d6b656;strokeWidth=2;entryX=0.5;entryY=0;curved=1;" edge="1" parent="1" source="api-server" target="annotation-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="400" y="185" />
              <mxPoint x="700" y="185" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Prometheus scrapes Flow Manager -->
        <mxCell id="prom-scrape-fm" value="" style="endArrow=classic;html=1;strokeColor=#004085;strokeWidth=2;exitX=0;exitY=0.5;curved=1;" edge="1" parent="1" source="prometheus" target="prom-exporter">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="180" />
              <mxPoint x="600" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Prometheus to Grafana -->
        <mxCell id="prom-to-grafana" value="" style="endArrow=classic;html=1;strokeColor=#004085;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="prometheus" target="grafana">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Cilium Agent to eBPF Maps -->
        <mxCell id="cilium-to-ebpf" value="" style="endArrow=classic;html=1;strokeColor=#9933ff;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;curved=1;" edge="1" parent="1" source="cilium-bwm" target="ebpf-maps">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ebpf-update-label" value="Update rate limit" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=8" vertex="1" connectable="0" parent="cilium-to-ebpf">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="30" as="offset" />
          </mxGeometry>
        </mxCell>
        
        <!-- eBPF enforcement flow -->
        <mxCell id="tc-to-prog" value="" style="endArrow=classic;html=1;strokeColor=#cc0000;strokeWidth=2;" edge="1" parent="1" source="tc-hook" target="ebpf-program">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="prog-to-maps" value="" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#cc0000;strokeWidth=2;" edge="1" parent="1" source="ebpf-program" target="ebpf-maps">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="veth-to-tc" value="" style="endArrow=classic;html=1;strokeColor=#cc0000;strokeWidth=2;" edge="1" parent="1" source="veth" target="tc-hook">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tc-to-nic" value="" style="endArrow=classic;html=1;strokeColor=#cc0000;strokeWidth=2;curved=1;" edge="1" parent="1" source="ebpf-program" target="nic">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="350" y="780" />
            </Array>
          </mxGeometry>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
